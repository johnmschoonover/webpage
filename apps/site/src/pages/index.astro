---
import BaseLayout from '@layouts/BaseLayout.astro';
import Hero from '@components/Hero.astro';
import Card from '@components/Card.astro';
import Timeline from '@components/Timeline.astro';
import Callout from '@components/Callout.astro';
import { getCollection } from 'astro:content';
import { experienceHighlights } from '@lib/utils';
import patents from '@content/data/patents.json';
import profile from '@data/profile.json';

const caseStudies = (await getCollection('case-studies')).sort((a, b) => a.data.order - b.data.order).slice(0, 3);
const posts = (await getCollection('posts')).sort((a, b) => (a.data.date > b.data.date ? -1 : 1)).slice(0, 3);
const patentEntries = (patents as { title: string; status: string; summary: string }[]);
const timeline = [
  {
    title: profile.current_role.title,
    subtitle: 'Current remit',
    time: 'Present',
    bullets: profile.current_role.focus.slice(0, 3)
  },
  {
    title: 'Where the work is heading',
    subtitle: 'Objectives',
    time: 'Looking ahead',
    bullets: profile.objectives
  }
];
---
<BaseLayout>
  <Hero />
  <section class="space-y-6">
    <div class="flex flex-col gap-2">
      <span class="text-xs uppercase tracking-[0.2em] text-muted-foreground">Case Studies</span>
      <h2 class="font-display text-2xl font-semibold">Strategic programs delivered end-to-end.</h2>
    </div>
    <div class="grid gap-6 md:grid-cols-3">
      {caseStudies.map((entry) => (
        <Card
          key={entry.id}
          eyebrow={entry.data.timeframe}
          title={entry.data.title}
          description={entry.data.description}
          href={`/case-studies/${entry.slug}/`}
          cta="Explore"
        />
      ))}
    </div>
  </section>
  <section class="grid gap-10 rounded-3xl border border-border bg-secondary/50 p-10 md:grid-cols-[1.2fr_1fr]">
    <div class="space-y-4">
      <span class="text-xs uppercase tracking-[0.2em] text-muted-foreground">Leadership arc</span>
      <h2 class="font-display text-2xl font-semibold">Operating at the intersection of platform engineering and cyber command.</h2>
      <p class="text-muted-foreground">
        Platform rigor, actionable telemetry, and clear storytelling keep teams aligned on the work that matters.
      </p>
      <Callout
        title="Current focus"
        body={`Key themes include ${experienceHighlights[0]} and ${experienceHighlights[1]}.`}
      />
    </div>
    <Timeline items={timeline} />
  </section>
  <section class="space-y-6">
    <div class="flex flex-col gap-2">
      <span class="text-xs uppercase tracking-[0.2em] text-muted-foreground">Writing</span>
      <h2 class="font-display text-2xl font-semibold">Latest thinking on security platforms.</h2>
    </div>
    <div class="grid gap-6 md:grid-cols-3">
      {posts.map((post) => (
        <Card
          key={post.id}
          eyebrow={new Date(post.data.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric' })}
          title={post.data.title}
          description={post.data.summary}
          href={`/writing/${post.slug}/`}
          cta="Read"
        />
      ))}
    </div>
  </section>
  <section class="space-y-6">
    <div class="flex flex-col gap-2">
      <span class="text-xs uppercase tracking-[0.2em] text-muted-foreground">Patents & IP</span>
      <h2 class="font-display text-2xl font-semibold">Protecting resilient SIEM coverage and signal fidelity.</h2>
    </div>
    <div class="grid gap-4 md:grid-cols-2">
      {patentEntries.map((patent) => (
        <div class="rounded-2xl border border-border bg-background/80 p-6" key={patent.title}>
          <p class="text-xs uppercase tracking-[0.2em] text-muted-foreground">{patent.status}</p>
          <h3 class="mt-2 font-display text-xl font-semibold">{patent.title}</h3>
          <p class="mt-3 text-xs text-muted-foreground">{patent.summary}</p>
        </div>
      ))}
    </div>
  </section>
  <section class="rounded-3xl border border-border bg-gradient-to-r from-primary/10 via-primary/5 to-secondary/40 p-10">
    <div class="flex flex-col items-start gap-4 md:flex-row md:items-center md:justify-between">
      <div>
        <h2 class="font-display text-2xl font-semibold text-foreground">Ready to compare notes on SIEM strategy?</h2>
        <p class="mt-2 max-w-2xl text-muted-foreground">Let's align on outcomes, cut through operational noise, and deliver measurable resilience.</p>
      </div>
      <a href="/contact" class="inline-flex items-center rounded-full bg-primary px-6 py-3 text-sm font-semibold text-primary-foreground shadow transition hover:bg-primary/90">Start the conversation â†’</a>
    </div>
  </section>
</BaseLayout>
