---
import BaseLayout from '@layouts/BaseLayout.astro';
import Callout from '@components/Callout.astro';
import { contactChannels } from '@lib/utils';
import profile from '@data/profile.json';

const { email_public } = profile;
const captchaSiteKey = import.meta.env.PUBLIC_HCAPTCHA_SITEKEY;
const captchaEnabled = Boolean(captchaSiteKey);
---
<BaseLayout pageHeading="Contact" description="Reach out for platform strategy, SIEM collaboration, or home lab experiments.">
  {captchaEnabled && (
    <Fragment slot="head">
      <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    </Fragment>
  )}
  <div class="grid gap-10 md:grid-cols-[1.2fr_1fr]">
    <section class="space-y-6">
      <p class="text-muted-foreground">
        Share context about your project or challenge. Messages route directly to John at {email_public}. Expect a thoughtful reply once the request is reviewed.
      </p>
      <form class="space-y-4 rounded-3xl border border-border bg-background/80 p-6 shadow-sm" method="post" action="/api/contact">
        <div class="grid gap-2">
          <label for="name" class="text-sm font-medium text-foreground">Name</label>
          <input id="name" name="name" type="text" required class="h-11 rounded-lg border border-input bg-background px-3 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" />
        </div>
        <div class="grid gap-2">
          <label for="email" class="text-sm font-medium text-foreground">Email</label>
          <input id="email" name="email" type="email" required class="h-11 rounded-lg border border-input bg-background px-3 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary" />
        </div>
        <div class="grid gap-2">
          <label for="message" class="text-sm font-medium text-foreground">How can I help?</label>
          <textarea id="message" name="message" rows="5" required class="rounded-lg border border-input bg-background px-3 py-2 text-sm text-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary"></textarea>
        </div>
        {captchaEnabled ? (
          <div class="h-captcha" data-sitekey={captchaSiteKey}></div>
        ) : (
          <p class="rounded-md border border-amber-500/40 bg-amber-500/10 p-3 text-xs text-amber-700">
            CAPTCHA is not yet configured. Messages may be throttled if suspicious activity is detected.
          </p>
        )}
        <button type="submit" class="inline-flex items-center justify-center rounded-full bg-primary px-6 py-3 text-sm font-semibold text-primary-foreground transition hover:bg-primary/90">Send</button>
        <p class="text-xs text-muted-foreground">This form is protected by hCaptcha to reduce automated abuse.</p>
      </form>
    </section>
    <aside class="space-y-6">
      <Callout
        title="Other channels"
        body="Use email for primary contact. LinkedIn is available for networking and quick introductions."
      />
      <div class="rounded-3xl border border-border bg-muted/50 p-6">
        <h2 class="font-display text-lg font-semibold">Direct links</h2>
        <ul class="mt-3 space-y-2 text-sm text-muted-foreground">
          {contactChannels.map((channel) => (
            <li key={channel.label}>
              {channel.todo ? (
                <span>TODO: {channel.todo}</span>
              ) : (
                <a class="text-primary hover:underline" href={channel.href}>{channel.label}</a>
              )}
            </li>
          ))}
        </ul>
      </div>
    </aside>
  </div>
</BaseLayout>
